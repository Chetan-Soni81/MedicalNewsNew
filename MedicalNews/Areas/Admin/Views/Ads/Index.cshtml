@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
    ViewData["Title"] = "Manage Ads";
}
@model AdsModel

@*Model for Update*@
<div id="myModal" class="modalc p-sm-3 rounded-3">

    <!-- Modal content -->
    <div class="modalc-content rounded-3 w-50">
        <div class="row justify-content-end">
            <div class="d-flex justify-content-end">
                <span class="modalc-close modalc-close-icon">&times;</span>
            </div>
        </div>
        <h3 class="text-center mb-3">Edit Ads Data</h3>
        <div class="p-3">
            <form id="editForm">
                <div class="row">
                    <label id="lblId" class="d-none"></label>
                    <label id="lblImage" class="d-none"></label>
                    <div class="col-md-8 col-sm-12 mb-3">
                        <label for="Title" class="form-label text-center">Title</label>
                        <input id="txtTitle" name="Title" class="form-control" placeholder="Link Title." required>
                    </div>

                    <div class="col-md-4 col-sm-12 mb-3">
                        <label for="Position" class="form-label text-center">Show On</label>
                        <select id="ddlPosition" class="form-control" required>
                            <option Value="1">Position 1</option>
                            <option Value="2">Position 2</option>
                            <option Value="3">Position 3</option>
                            <option Value="2">Position 4</option>
                        </select>
                    </div>

                    <div class="col-md-7 col-sm-12 mb-3">
                        <label for="WebUrl" class="form-label text-center">Web Url</label>
                        <input id="txtWebUrl" name="WebUrl" class="form-control" placeholder="Please Enter the Web Url">
                    </div>

                    <div class="col-md-5 col-sm-12 mb-3">
                        <label for="AdsImage" class="form-label text-center">Ads Image</label>
                        <input id="imgAdsImage" type="file" name="AdsImage" accept="image/*" class="form-control" />
                    </div>

                    <div class="col-md-5 col-sm-12 mb-3">
                        <label for="ShowFrom" class="form-label text-center">Show From</label>
                        <input id="txtShowFrom" type="date" name="ShowFrom" class="form-control" placeholder="Show From" required>

                    </div>
                    <div class="col-md-5 col-sm-12 mb-3">
                        <label for="ShowTo" class="form-label text-center">Show To</label>
                        <input id="txtShowTo" type="date" name="ShowTo" class="form-control" placeholder="Show To" required>

                    </div>

                    <div class="col-2 pt-4 mb-3">
                        <button type="submit" class="mt-1 btn btn-block btn-success">Save</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
@*Model for Insert*@
<div id="addModal" class="modalc p-sm-3 rounded-3">

    <!-- Modal content -->
    <div class="modalc-content rounded-3 w-50">
        <div class="row justify-content-end">
            <div class="d-flex justify-content-end">
                <span class="modalc-close modalc-close-icon">&times;</span>
            </div>
        </div>
        <h3 class="text-center mb-3">Insert Advertisement Data</h3>
        <div class="p-3">
            <form id="addForm">
                <div class="row">
                    <div class="col-md-8 col-sm-12 mb-3">
                        <label for="Title" class="form-label text-center">Title</label>
                        <input id="addTitle" name="Title" class="form-control" placeholder="Link Title." required>
                    </div>

                    <div class="col-md-4 col-sm-12 mb-3">
                        <label for="Position" class="form-label text-center">Show On</label>
                        <select id="ddlAddPosition" class="form-control" required>
                            <option Value="1">Position 1</option>
                            <option Value="2">Position 2</option>
                            <option Value="3">Position 3</option>
                            <option Value="2">Position 4</option>
                        </select>
                    </div>

                    <div class="col-md-7 col-sm-12 mb-3">
                        <label for="WebUrl" class="form-label text-center">Web Url</label>
                        <input id="addWebUrl" name="WebUrl" class="form-control" placeholder="Please Enter the Web Url">
                    </div>

                    <div class="col-md-5 col-sm-12 mb-3">
                        <label for="AdsImage" class="form-label text-center">Ads Image</label>
                        <input id="imgAddAdsImage" type="file" name="AdsImage" accept="image/*" class="form-control" />
                    </div>

                    <div class="col-md-5 col-sm-12 mb-3">
                        <label for="ShowFrom" class="form-label text-center">Show From</label>
                        <input id="addShowFrom" type="date" name="ShowFrom" class="form-control" placeholder="Show From" required>

                    </div>
                    <div class="col-md-5 col-sm-12 mb-3">
                        <label for="ShowTo" class="form-label text-center">Show To</label>
                        <input id="addShowTo" type="date" name="ShowTo" class="form-control" placeholder="Show To" required>

                    </div>

                    <div class="col-2 pt-4 mb-3">
                        <button type="submit" class="mt-1 btn btn-block btn-success">Save</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="container-fluid p-0">
    <div class="notice-wrap">
        <label ID="lblMessage" class="notice-wrap"></label>
    </div>
    <div class="mb-3">
        <h1 class="h3 d-inline align-middle">Manage Ads</h1>
    </div>
    @*<div class="row d-none">
        <div class="col-12 ">
            <div class="card">
                <div class="card-body">
                    <div class="col-12">
                        <form method="post" asp-action="Index" asp-controller="Ads" asp-area="Admin" enctype="multipart/form-data">
                            <div class="row mb-3">
                                <div class="col-md-6 col-sm-12">
                                    <label asp-for="Title" class="form-label text-center">Title</label>
                                    <input asp-for="Title" class="form-control" placeholder="Link Title.">
                                    <span asp-validation-for="Title" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 col-sm-12">
                                    <label asp-for="WebUrl" class="form-label text-center">Web Url</label>
                                    <input asp-for="WebUrl" class="form-control" placeholder="Please Enter the Web Url">
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-4 col-sm-12">
                                    <label asp-for="Position" class="form-label text-center">Show On</label>
                                    <select asp-for="Position" class="form-control">
                                        <option Value="">--Select Position--</option>
                                        <option Value="1">Position 1</option>
                                        <option Value="2">Position 2</option>
                                        <option Value="3">Position 3</option>
                                        <option Value="2">Position 4</option>
                                    </select>
                                    <span asp-validation-for=Position class="text-danger"></span>
                                </div>
                                <div class="col-md-4 col-sm-12">
                                    <label asp-for="ShowFrom" class="form-label text-center">Show From</label>
                                    <input type="date" asp-for="ShowFrom" class="form-control" placeholder="Show From">
                                    <span asp-validation-for="ShowFrom" class="text-danger"></span>

                                </div>
                                <div class="col-md-4 col-sm-12">
                                    <label asp-for="ShowTo" class="form-label text-center">Show To</label>
                                    <input type="date" asp-for="ShowTo" class="form-control" placeholder="Show To">
                                    <span asp-validation-for="ShowTo" class="text-danger"></span>

                                </div>

                            </div>

                            <div class="row mb-3">
                                <div class="col-md-8 col-sm-12">
                                    <label asp-for="AdsImage" class="form-label text-center">Ads Image</label>
                                    <input type="file" asp-for="AdsImage" class="form-control" accept="image/*" />
                                    <span asp-validation-for="AdsImage" class="text-danger"></span>
                                </div>
                                <div class="col-2 p-4 mt-1">
                                    <button type="submit" class="btn btn-block btn-success">Save</button>
                                </div>
                            </div>
                        </form>
                        <div class="row mb-3 bg-success">
                            <div class="col-md-12 col-sm-12">
                                <label ID="lblmsg" class="notice-wrap">@ViewData["Message"]</label>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>*@
    <div class="col-12 ">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">List Of All Ads </h5>
            </div>
            <div class="card-body">
                <div class="col-12">
                    <div class="row">
                        <div class="d-flex justify-content-end mb-3">
                            <a class="text-primary modelc-toggler" model-target="#addModal"><i class="fa-regular fa-square-plus"></i> Add Advertisement</a>
                        </div>
                        <table id="dataTableData" class="table table-bordered table-striped table-hover">
                            <thead>

                                <tr>
                                    <th>Title</th>
                                    <th>Web Url</th>
                                    <th>Show From Date</th>
                                    <th>Show To Date</th>
                                    <th>Created Date</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            @*foreach (var item in (ViewBag.Ads as IEnumerable<MedicalNews.Areas.Admin.Models.AdsModel>))
                            {
                            <tr>
                            <td>@item.Title</td>
                            <td>@item.WebUrl</td>
                            <td>@item.ShowFrom</td>
                            <td>@item.ShowTo</td>
                            <td>@item.CreatedDate</td>
                            <td>
                            <a role="button" class="btn" style="background: #343A40" href="/Admin/Ads/DeleteAds/?id=@item.AdsId&filepath=@item.ImageUrl">
                            <i class="fa fa-trash text-white"></i>
                            </a>
                            <a role="button" class="btn btn-danger modelc-toggler" model-target="#myModal">
                            <i class="fa fa-edit"></i>
                            </a>
                            </td>
                            </tr>
                            }*@
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        var table;
        var ads;
        $(document).ready(function () {
            GetAds(() => CreateTable())
        })

        function GetAds(next) {
            $.ajax({
                url: "/Admin/Ads/GetAdsJson",
                type: 'GET',
                dataType: 'json',
                success: function (response) {
                    ads = response
                    next();
                }
            })
        }

        function CreateTable() {
            table = $('#dataTableData').DataTable({
                bProcessing: true,
                bLengthChange: true,
                lengthMenu: [[10, 25, -1], [10, 25, 'All']],
                bFilter: true,
                bSort: true,
                bPaginate: true,
                data: ads,
                columns: [
                    {
                        data: "Title",
                        render: (data, type, row, meta) => {
                            return row.title;
                        }
                    },
                    {
                        data: "WebUrl",
                        render: (data, type, row, meta) => {
                            return row.webUrl;
                        }
                    },
                    {
                        data: "Show From Date",
                        render: (data, type, row, meta) => {
                            return new Date(row.showFrom).toLocaleString('en-IN', { day: "2-digit", month: "2-digit", year: "numeric", hour12: true, hour: "2-digit", minute: "2-digit", second: "2-digit" });
                        }
                    },
                    {
                        data: "Show To Date",
                        render: (data, type, row, meta) => {
                            return new Date(row.showTo).toLocaleString('en-IN', { day: "2-digit", month: "2-digit", year: "numeric", hour12: true, hour: "2-digit", minute: "2-digit", second: "2-digit" });
                        }
                    },
                    {
                        data: "Created Date",
                        render: (data, type, row, meta) => {
                            return new Date(row.createdDate).toLocaleDateString('en-IN', { day: "2-digit", month: "2-digit", year: "numeric", hour12: true, hour: "2-digit", minute: "2-digit", second: "2-digit" });
                        }
                    },
                    {
                        data: "Action",
                        render: (data, type, row, meta) => {
                            return `<a id="${row.adsId}" url="${row.imageUrl}"  role="button" style="background: #343A40;" class="btn" onclick="DeleteInterview(this)">
                                                                                                                                                <i class="fa fa-trash text-white"></i>
                                                                                                                                            </a>
                                                                                                                                            <a id="${row.adsId}" url="${row.imageUrl}"  role="button" class="btn bg-danger modelc-toggler" model-target="#myModal" onclick="OpenModal(this)">
                                                                                                                                                <i class="fa fa-edit text-white"></i>
                                                                                                                                            </a>`
                        }
                    }
                ]
            })
        }

        function DeleteInterview(obj) {
            var id = $(obj).attr('id');
            var imageurl = $(obj).attr('url')

            $.ajax({
                url: `/Admin/Ads/DeleteAds?id=${id}&filepath=${imageurl}`,
                type: "Delete",
                dataType: "json",
                success: (res) => {
                    if (res) {
                        dtRow = $(obj).closest('tr');  //assigning value on click delete
                        table.row(dtRow).remove().draw(false);
                    }
                }
            })
        }

        function OpenModal(obj) {
            var modal = $(obj).attr('model-target');

            var id = $(obj).attr('id');

            $.ajax({
                url: `/Admin/Ads/GetAdsById/${id}`,
                type: 'GET',
                dataType: 'json',
                success: (res) => {
                    //debugger;
                    $('#lblId').val(res.adsId);
                    $('#lblImage').val(res.imageUrl);
                    $('#txtTitle').val(res.title);
                    $('#txtWebUrl').val(res.webUrl);
                    $('#ddlPosition').val(res.position.toString());
                    $('#txtShowFrom').val(new Date(res.showFrom).toLocaleDateString('en-IN'))
                    $('#txtShowTo').val(new Date(res.showTo).toLocaleDateString('en-IN'))
                    //$('#txtShowTo').val(res.showTo);
                }
            });

            $(modal).css('display', 'block');
        }

        $('#editForm').on('submit', function (e) {
            e.preventDefault();

            var data = new FormData();
            data.append('adsId', $('#lblId').val());
            data.append('imageUrl', $('#lblImage').val());
            data.append('title', $('#txtTitle').val());
            data.append('webUrl', $('#txtWebUrl').val());
            data.append('position', $('#ddlPosition').val());
            data.append('showFrom', $('#txtShowFrom').val());
            data.append('showTo', $('#txtShowTo').val());
            data.append('adsImage', $('#imgAdsImage')[0].files[0]);
            console.log(data);

            $.ajax({
                url: '/Admin/Ads/UpdateAds',
                type: 'PUT',
                data: data,
                cache: false,
                contentType: false,
                processData: false,
                dataType: 'json',
                success: (res) => {
                    debugger;
                    if (res) {
                        GetAds(() => {
                            table.clear();
                            table.rows.add(ads).draw();
                        })
                    }
                }
            });

            $('#myModal').css('display', 'none');

        });

        $('#addForm').on('submit', function (e) {
            e.preventDefault();

            var data = new FormData();
            data.append('title', $('#addTitle').val());
            data.append('webUrl', $('#addWebUrl').val());
            data.append('position', $('#ddlAddPosition').val());
            data.append('showFrom', $('#addShowFrom').val());
            data.append('showTo', $('#addShowTo').val());
            data.append('adsImage', $('#imgAddAdsImage')[0].files[0]);
            console.log(data);

            $.ajax({
                url: '/Admin/Ads/CreateAds',
                type: 'POST',
                data: data,
                cache: false,
                contentType: false,
                processData: false,
                dataType: 'json',
                success: (res) => {
                    debugger;
                    if (res) {
                        GetAds(() => {
                            table.clear();
                            table.rows.add(ads).draw();
                        })
                    }
                }
            });
            $('#addForm')[0].reset();
            $('#addModal').css('display', 'none');

        });
    </script>
}