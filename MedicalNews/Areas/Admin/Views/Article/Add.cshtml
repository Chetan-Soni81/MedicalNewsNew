@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
    ViewData["Title"] = "Create Article";
}
@model ArticleModel


<div class="container-fluid p-0">
    <div class="notice-wrap">
        <asp:Label ID="lblMessage" runat="server" class="notice-wrap"></asp:Label>
    </div>
    <div class="mb-3">
        <h1 class="h3 d-inline align-middle">Manage Article</h1>
    </div>
    <div class="row">
        <div class="col-12 ">
            <div class="card">
                <div class="card-body">
                    <div class="col-12">
                        <form method="post" enctype="multipart/form-data" asp-action="Add" asp-controller="Article" asp-area="Admin">
                            <div class="row mb-3">
                                <div class="col-md-6 col-sm-12">
                                    <label asp-for="ArticleCategoryId" class="form-label text-center">Article Category</label>
                                    <select class="form-select" id="ddlArticleCategory" asp-for="ArticleCategoryId">
                                        <option value="">--Select Article Category--</option>
                                        @foreach (var item in (ViewBag.Categories as IEnumerable<ArticleCategoryModel>))
                                        {
                                            <option value="@item.Id">@item.Category</option>
                                        }
                                    </select>
                                    <span asp-validation-for="ArticleCategoryId" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 col-sm-12">
                                    <label asp-for="ArticleSubCategoryId" class="form-label text-center">Article Sub Category</label>
                                    <select class="form-select" id="ddlArticleSubCategory" asp-for="ArticleSubCategoryId">
                                        <option value="">--Select Article Sub Category--</option>
                                    </select>
                                    <span asp-validation-for="ArticleSubCategoryId" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-12 col-sm-12">
                                    <label asp-for="ArticleTitle" class="form-label text-center">Article Title</label>
                                    <input class="form-control" asp-for=ArticleTitle placeholder="Article Title." />
                                    <span asp-validation-for="ArticleTitle" class="text-danger"></span>
                                </div>

                            </div>
                            <div class="row mb-3">
                                <div class="col-md-12 col-sm-12">
                                    <label asp-for="ArticleShortDiscription" class="form-label text-center">Article Short Description</label>
                                    <textarea asp-for=ArticleShortDiscription class="form-control" placeholder="Article Short Description." rows="3"></textarea>
                                    <span asp-validation-for="ArticleShortDiscription" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-12 col-sm-12">
                                    <label for="WEb Url" class="form-label text-center">Web Url</label>
                                    <input asp-for=WebUrl class="form-control" placeholder="Enter the Article Web URL." />
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-4 col-sm-12">
                                    <label asp-for="ShowOnHomePage" class="form-label text-center">Show On Home Page</label>
                                    <select class="form-select" asp-for="ShowOnHomePage">
                                        <option value="">--Please Select--</option>
                                        <option value=True>Yes</option>
                                        <option value=False>No</option>
                                    </select>
                                    <span asp-validation-for="ShowOnHomePage" class="text-danger"></span>
                                </div>
                                <div class="col-md-4 col-sm-12">
                                    <label asp-for="ShowOnBanner" class="form-label text-center">Show On Banner</label>
                                    <select class="form-select" asp-for="ShowOnBanner">
                                        <option value="">--Please Select--</option>
                                        <option value=True>Yes</option>
                                        <option value=False>No</option>
                                    </select>
                                    <span asp-validation-for="ShowOnBanner" class="text-danger"></span>
                                </div>
                                <div class="col-md-4 col-sm-12">
                                    <label for="Is Latest" class="form-label text-center">Is Latest</label>
                                    <select asp-for=IsBrakeing ID="ddlIsLatest" runat="server" class="form-select">
                                        <option value="">--Please Select--</option>
                                        <option value=True>Yes</option>
                                        <option value=False>No</option>
                                    </select>
                                    <span asp-validation-for="IsBrakeing" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-12 col-sm-12">
                                    <label asp-for="Description1" class="form-label text-center">Article Description 1</label>
                                    <textarea class="form-control ckeditor" id="ckeditor1" asp-for=Description1 placeholder="Article Descriptione 1" rows="8"></textarea>
                                    <span asp-validation-for="Description1" class="text-danger"></span>
                                </div>

                            </div>
                            <div class="row mb-3">
                                <div class="col-md-12 col-sm-12">
                                    <label asp-for="Description2" class="form-label text-center">Article Description 2</label>
                                    <textarea id="ckeditor2" class="form-control ckeditor" asp-for=Description2 placeholder="Article Descriptione 2" rows="8"></textarea>
                                    <span asp-validation-for="Description2" class="text-danger"></span>
                                </div>

                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6 col-sm-12">
                                    <label asp-for="Image1" class="form-label text-center">Ads Image 1</label>
                                    <input type="file" class="form-control" asp-for="Image1" />
                                    <span asp-validation-for="Image1" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 col-sm-12">
                                    <label asp-for="Image2" class="form-label text-center"> Image 2</label>
                                    <input type='file' class="form-control" asp-for="Image2" />
                                </div>
                            </div>

                            <div class="row mb-3">

                                <div class="col-2 p-4 mt-1">
                                    <button type="submit" class="btn btn-block btn-success">Save</button>
                                </div>
                                <div class="col-2 p-4 mt-1">
                                    <button type="reset" class="btn btn-block btn-success">Reset</button>
                                </div>

                            </div>
                            <div class="row bg-success">
                                <div class="col-md-12 col-sm-12">
                                    <label class="notice-wrap">@ViewData["Message"]</label>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <div class="col-12 ">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">List Of All Ads </h5>
            </div>
            <div class="card-body">
                <div class="col-12">
                    <div class="row">
                        <div class="table-responsive">
                            <table class="table table-bordered table-striped table-hover" id="dataTableData">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Category</th>
                                        <th>Sub Category</th>
                                        <th>Posted Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>

                            </table>
                        </div>

                        @*
                        <asp:GridView ID="grdAtricle" runat="server" GridLines="None" class="table table-bordered table-striped table-hover" AutoGenerateColumns="False" EmptyDataText="No More Record" AllowPaging="True">
                            <Columns>
                            <asp:TemplateField HeaderText="Title">
                                <ItemTemplate>
                                    <asp:Label ID="lblTitle" runat="server" Text='<%# Bind("ArticleTitle") %>'></asp:Label>
                                </ItemTemplate>
                            </asp:TemplateField>
                            <asp:TemplateField HeaderText="Category">
                                <ItemTemplate>
                                    <asp:Label ID="lblCategory" runat="server" Text='<%# Bind("ArticleCategoryName") %>'></asp:Label>
                                </ItemTemplate>
                            </asp:TemplateField>
                            <asp:TemplateField HeaderText="Sub Category">
                                <ItemTemplate>
                                    <asp:Label ID="lblSubCategory" runat="server" Text= <%# Bind("ArticleSubCategoryName") %>></asp:Label>
                                </ItemTemplate>
                            </asp:TemplateField>

                            <asp:TemplateField HeaderText="Posted Date">
                                <ItemTemplate>
                                    <asp:Label ID="lblPostedDate" runat="server" Text= <%# Convert.ToDateTime(Eval("CreatedDate")).ToString("dd/MM/yyyy") %>></asp:Label>
                                </ItemTemplate>
                            </asp:TemplateField>
                            <asp:TemplateField HeaderText="Action">
                                <ItemTemplate>
                                    <asp:HyperLink ID="hypView" runat="server" NavigateUrl='<%#"ViewArticle.aspx?ArticleID=" + StringC.Encrypt(Eval("ArticleId").ToString())%>' class="btn" BackColor="#343A40" BorderStyle="None" ForeColor="White">
                                        <i class="fa fa-eye" aria-hidden="true"></i>
                                    </asp:HyperLink>
                                    <asp:HyperLink ID="hypEdit" runat="server" NavigateUrl='<%#"EditArticle.aspx?ArticleID=" + StringC.Encrypt(Eval("ArticleId").ToString())%>' class="btn" BackColor="#343A40" BorderStyle="None" ForeColor="White">
                                        <i class="fa fa-edit" aria-hidden="true"></i>
                                    </asp:HyperLink>
                                    <asp:LinkButton ID="btnArticleDelete" runat="server" CommandArgument='<%# Eval("ArticleId") %>' OnClick="btnArticleDelete_Click" OnClientClick="return confirm('Are you sure you want to delete this Article?')" class="btn" BackColor="Red" BorderStyle="None" ForeColor="White">
                                        <i class="fa fa-trash" aria-hidden="true"></i>
                                    </asp:LinkButton>
                                </ItemTemplate>
                                <ItemStyle Width="160px" Height="25px" HorizontalAlign="left"></ItemStyle>
                                <HeaderStyle HorizontalAlign="Right"></HeaderStyle>
                            </asp:TemplateField>
                            </Columns>
                            <PagerSettings PageButtonCount="5" Position="Bottom" Mode="NumericFirstLast" FirstPageText="First" LastPageText="Last" />
                            <PagerStyle class="pagination-ys" />
                        </asp:GridView>
                        *@
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts{
    <script src="~/lib/ckeditor/ckeditor.js"></script>
    <script>

        var table;
        var articles;
        $(document).ready(function () {
            GetCategory(() => CreateTable())
        })

        function GetCategory(next) {
            $.ajax({
                url: "/Admin/Article/GetArticleJson/",
                type: 'GET',
                dataType: 'json',
                success: function (response) {
                    articles = response
                    next();
                }
            })
        }

        function CreateTable() {
            table = $('#dataTableData').DataTable({
                bProcessing: true,
                bLengthChange: true,
                lengthMenu: [[10, 25, -1], [10, 25, 'All']],
                bFilter: true,
                bSort: true,
                bPaginate: true,
                data: articles,
                columns: [
                    {
                        data: 'Title',
                        render: (data, type, row, meta) => {
                            return row.articleTitle;
                        }
                    },
                    {
                        data: "Category",
                        render: (data, type, row, meta) => {
                            return row.articleCategoryName;
                        }
                    },
                    {
                        data: "Sub Category",
                        render: (data, type, row, meta) => {
                            return row.articleSubCategoryName;
                        }
                    },
                    {
                        data: "Posted Date",
                        render: (data, type, row, meta) => {
                            return new Date(row.createdDate).toLocaleDateString('en-In')
                        }
                    },
                    {
                        data: "Actions",
                        render: (data, type, row, meta) => {
                            return `<a class="btn" style="background: #343A40;" >
                                                <i class="fa fa-eye text-white" aria-hidden="true"></i>
                                            </a>
                            <a id="${row.articleId}"  role="button" style="background: #343A40;" class="btn" onclick="DeleteArticle(this)">
                                                <i class="fa fa-trash text-white"></i>
                                            </a>
                                            <a id="${row.articleId}" role="button" class="btn bg-danger">
                                                <i class="fa fa-edit text-white"></i>
                                            </a>`
                        }
                    }
                ]
            })
        }

        function DeleteArticle(obj) {
            var id = $(obj).attr('id');

            $.ajax({
                url: `/Admin/Article/DeleteArticle/${id}`,
                type: "Delete",
                dataType: "json",
                success: (res) => {
                    if (res) {
                        dtRow = $(obj).closest('tr');  //assigning value on click delete
                        var stockistTable = $('#dataTableData').DataTable();
                        stockistTable.row(dtRow).remove().draw(false);
                    }
                }
            })
        }

        $('#ddlArticleCategory').change(function(e) {
            var id = $(e.target).val()

            $.ajax({
                url: `/Admin/Category/GetArticleSubJson/${id}`,
                type: 'GET',
                dataType: 'json',
                success: function(res) {
                    debugger;
                    $('#ddlArticleSubCategory').empty().append('<option value="">--Select Article Sub Category--</option>');

                    for(var i = 0; i < res.length; i++){
                        var opt = document.createElement('option')
                        opt.value = res[i].id;
                        opt.innerText= res[i].articleSubCategoryName;
                        $('#ddlArticleSubCategory').append(opt);
                    }
            //e.preventDefault();
                }
            })
        })

        
    </script>
}